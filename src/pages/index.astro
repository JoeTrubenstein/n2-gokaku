---
import { getCollection } from "astro:content";
import Layout from "@layouts/Layout.astro";
import Hero from "@components/Hero.astro";
import Header from "@components/Header.astro";
import Footer from "@components/Footer.astro";
import LinkButton from "@components/LinkButton.astro";
import Hr from "@components/Hr.astro";
import Card from "../components/Card";
import getSortedPosts from "@utils/getSortedPosts";

const posts = await getCollection("blog");

const sortedPosts = getSortedPosts(posts);
const recentPosts = sortedPosts.filter(({ data }) => !data.featured);
---

<Layout>
  <Header />
  <main id="main-content">
    <Hero />
    <Hr />
    <section id="quick-start" class="py-12">
      <div class="mx-auto max-w-4xl">
        <h2 class="mb-4 text-2xl font-semibold tracking-wide">Quick Start</h2>
        <div class="space-y-6 text-lg text-skin-base">
          <div>
            <a
              href="/vocabulary/"
              class="inline-block text-lg font-medium text-skin-accent decoration-dashed underline-offset-4 hover:underline focus-visible:no-underline focus-visible:underline-offset-0"
            >
              語彙 (Vocabulary)
            </a>
            <br />
            Build your business-level word bank with essential N2 vocabulary.
            <br />
          </div>
          <div>
            <a
              href="/grammar/"
              class="inline-block text-lg font-medium text-skin-accent decoration-dashed underline-offset-4 hover:underline focus-visible:no-underline focus-visible:underline-offset-0"
            >
              文法 (Grammar)
            </a><br />
            Conquer the must-know N2 grammar structures for confident communication.
            <br />
          </div>
          <div>
            <a
              href="/reading/"
              class="inline-block text-lg font-medium text-skin-accent decoration-dashed underline-offset-4 hover:underline focus-visible:no-underline focus-visible:underline-offset-0"
            >
              読解 (Reading)
            </a><br />
            Practice with authentic N2 passages to boost your comprehension speed.
            <br />
          </div>
          <div>
            <a
              href="/listening/"
              class="inline-block text-lg font-medium text-skin-accent decoration-dashed underline-offset-4 hover:underline focus-visible:no-underline focus-visible:underline-offset-0"
            >
              聴解 (Listening)
            </a><br />
            Train your ears on authentic N2 audio for real-world understanding. <br
            />
          </div>
          <div>
            <a
              href="/products/"
              class="inline-block text-lg font-medium text-skin-accent decoration-dashed underline-offset-4 hover:underline focus-visible:no-underline focus-visible:underline-offset-0"
            >
              製品 (Products)
            </a><br />
            Premium N2 study tools and N2-inspired merch to level-up your learning.
            <br />
          </div>
        </div>
      </div>
    </section>
    <Hr />
    {
      recentPosts.length > 0 && (
        <>
          <section id="recent-posts" class="py-12">
            <div class="mx-auto max-w-7xl">
              <h2 class="text-3xl font-bold">Recent Blog Posts</h2>
              <div>
                {recentPosts.map(
                  ({ data, slug }, index) =>
                    index < 2 && (
                      <Card href={`/blog/${slug}/`} frontmatter={data} />
                    )
                )}
              </div>
              <div class="all-posts-btn-wrapper mt-8">
                <LinkButton href="/blog/">
                  all posts
                  <svg xmlns="http://www.w3.org/2000/svg">
                    <path d="m11.293 17.293 1.414 1.414L19.414 12l-6.707-6.707-1.414 1.414L15.586 11H6v2h9.586z" />
                  </svg>
                </LinkButton>
              </div>
            </div>
          </section>
          <Hr />
        </>
      )
    }

    <!-- Newsletter Signup -->
    <section id="newsletter" class="my-8">
      <div class="mx-auto max-w-4xl rounded-xl">
        <h3 class="mb-4 text-center text-2xl font-semibold">
          N2 Gokaku Newsletter
        </h3>
        <p class="mb-6 flex-grow text-center text-lg">
          Your weekly bento of N2 Japanese. <br />Simple, satisfying, and
          perfectly portioned for a quick study break.
        </p>
        <div
          style="min-height: 58px;max-width: 440px;margin: 0 auto;width: 100%"
        >

        <div class="gh-signup-form">
          <script
            src="https://cdn.jsdelivr.net/ghost/signup-form@~0.2/umd/signup-form.min.js"
            data-button-color="#1B998B"
            data-button-text-color="#ffffff"
            data-site="https://cms.n2gokaku.com/"
            data-locale="en"
            async>
          </script>
        </div>

        </div>
      </div>
    </section>
  </main>
  <Hr />
  <Footer />
</Layout>

<style>
  /* ===== Hero Section ===== */
  #hero {
    @apply pb-6 pt-8;
  }
  #hero h1 {
    @apply my-4 inline-block text-3xl font-bold sm:my-8 sm:text-5xl;
  }
  #hero .rss-link {
    @apply mb-6;
  }
  #hero .rss-icon {
    @apply mb-2 h-6 w-6 scale-110 fill-skin-accent sm:mb-3 sm:scale-125;
  }
  #hero p {
    @apply my-2;
  }
  .social-wrapper {
    @apply mt-4 flex flex-col sm:flex-row sm:items-center;
  }
  .social-links {
    @apply mb-1 mr-2 whitespace-nowrap sm:mb-0;
  }

  /* ===== Featured & Recent Posts Sections ===== */
  #featured,
  #recent-posts {
    @apply pb-6 pt-12;
  }
  #featured h2,
  #recent-posts h2 {
    @apply text-2xl font-semibold tracking-wide;
  }
  .all-posts-btn-wrapper {
    @apply my-8 text-center;
  }

  #user-mail {
    color: #282728;
  }


</style>
